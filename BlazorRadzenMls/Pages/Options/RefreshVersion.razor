@page "/refresh"

@using BlazorRadzenMls.Models
@using System.Timers

<RadzenLabel Text=@_currentVersion class="rz-color-success-dark" Style="font-weight: bold;" />

@if (_version != null && _version.NeedUpdate)
{
    <RadzenLabel Text=@_updateVersion class="rz-color-danger-dark" Style="font-weight: bold;" />
}

<RadzenButton Text="@_btnLablel" Icon="autorenew"
              ButtonStyle="ButtonStyle.Warning" Click="@ReloadApp" />

@code {

    private VersionReload? _version { get; set; }

    private string _currentVersion => __lang["Current_version_is"] + ": " + AppValues.VersionClient;
    private string _updateVersion => __lang["Update_version_available"] + ": " + _version?.Version;
    private string _btnLablel => (_version?.NeedUpdate == true) ? __lang["Update"] : __lang["Refresh"];

    private async Task ReloadApp() { await VersionReload.Reload(__js); }
    //private void ReloadApp() { navigationManager.Refresh(true); }

    protected override async void OnInitialized()
    {
        _version = new VersionReload(__js);
        await _version.Initialize;
        StateHasChanged();
        _version.TimerTick += delegate
        {
            if (_version.NeedUpdate)
                StateHasChanged();
        };

        __state.RefreshEvent += delegate { StateHasChanged(); }; //Refresh_Event;
    }
    //private void Refresh_Event(object? sender, EventArgs e) { StateHasChanged(); }

}